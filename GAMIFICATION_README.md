# ゲーミフィケーション機能

このドキュメントでは、マイメモアプリに追加されたゲーミフィケーション機能について説明します。

## 概要

ユーザーエンゲージメントを向上させるために、以下のゲーミフィケーション機能が追加されました:

- **ポイント/経験値システム**: 各アクションでポイントを獲得
- **レベルシステム**: ポイントに基づいてレベルアップ
- **実績・バッジシステム**: 特定の目標を達成すると実績解除
- **連続使用日数(ストリーク)**: 毎日メモを作成すると連続日数が増加
- **統計ダッシュボード**: 進捗を可視化

## セットアップ

### 1. データベースマイグレーション

Supabaseのダッシュボードにログインし、SQL Editorで`supabase_migration.sql`のコンテンツを実行してください。

このマイグレーションは以下を作成します:
- `user_stats` テーブル: ユーザー統計情報を保存
- `user_achievements` テーブル: ユーザーの実績進捗を追跡
- 適切なインデックスとRLSポリシー

### 2. 使用方法

#### ホームページでレベルを確認
ホームページの上部にレベル、ポイント、連続日数が表示されます。タップすると統計ページに移動します。

#### 統計・実績ページ
メニューから「統計・実績」を選択すると、以下の情報が表示されます:
- 現在のレベルと次のレベルまでの進捗
- メモ作成数、カテゴリ数、共有回数などの統計
- 達成済み・未達成の実績一覧

## 実績リスト

### メモ関連
- **最初の一歩** (📝): 初めてのメモを作成 - 10pt
- **メモマスター** (📚): 10個のメモを作成 - 50pt
- **メモの達人** (🎓): 50個のメモを作成 - 100pt
- **メモの伝説** (🏆): 100個のメモを作成 - 200pt

### カテゴリ関連
- **整理整頓** (📁): 初めてのカテゴリを作成 - 15pt
- **カテゴリマスター** (🗂️): 5個のカテゴリを作成 - 75pt

### 共有関連
- **シェア開始** (🔗): 初めてメモを共有 - 20pt
- **シェアマスター** (🌐): 10個のメモを共有 - 100pt

### 整理関連
- **お気に入り発見** (⭐): 初めてお気に入りに追加 - 10pt
- **リマインダー使い** (⏰): リマインダーを設定 - 15pt
- **添付ファイルマスター** (📎): 初めて添付ファイルを追加 - 20pt

### 連続使用関連
- **3日連続** (🔥): 3日連続でメモを作成 - 30pt
- **1週間連続** (🌟): 7日連続でメモを作成 - 75pt
- **30日連続** (💎): 30日連続でメモを作成 - 200pt

## ポイント獲得アクション

- メモ作成: 10pt
- メモ更新: 5pt (現在未実装)
- カテゴリ作成: 15pt
- メモ共有: 15pt
- お気に入り追加: 5pt
- リマインダー設定: 10pt
- 添付ファイル追加: 10pt

## レベルシステム

レベルは総ポイントに基づいて計算されます:

```
レベル = √(ポイント / 100) + 1
```

例:
- レベル1: 0-99ポイント
- レベル2: 100-399ポイント
- レベル3: 400-899ポイント
- レベル4: 900-1599ポイント

### レベル称号

- レベル1-2: メモ初心者
- レベル3-4: メモ学習者
- レベル5-9: メモの使い手
- レベル10-14: メモマスター
- レベル15-19: メモの達人
- レベル20+: メモの神

## 技術詳細

### 主要ファイル

**モデル:**
- `lib/models/achievement.dart` - 実績モデルと定義
- `lib/models/user_stats.dart` - ユーザー統計モデル

**サービス:**
- `lib/services/gamification_service.dart` - ゲーミフィケーション機能のコアロジック

**UI:**
- `lib/pages/stats_page.dart` - 統計・実績ページ
- `lib/widgets/achievement_card_widget.dart` - 実績カード
- `lib/widgets/level_display_widget.dart` - レベル表示
- `lib/widgets/stats_overview_widget.dart` - 統計概要
- `lib/widgets/achievement_notification.dart` - 実績通知

### 今後の拡張可能性

1. **イベント統合**: 現在、ポイント付与と実績チェックは手動で呼び出す必要があります。将来的には、各アクション(メモ作成、カテゴリ作成など)に自動的に統合できます。

2. **追加実績**: より多くの実績を簡単に追加できます。`AchievementDefinitions.getDefaultAchievements()`に新しい実績を追加するだけです。

3. **リーダーボード**: ユーザー間でポイントやレベルを競えるリーダーボード機能を追加可能です。

4. **カスタム報酬**: 特定のレベルや実績達成時に特別な機能やテーマをアンロックする機能を追加できます。

## トラブルシューティング

### 統計が表示されない
- データベースマイグレーションが正しく実行されているか確認してください
- ユーザーがログインしているか確認してください
- ブラウザのコンソールでエラーを確認してください

### 実績が解除されない
- `GamificationService`のメソッドが正しく呼び出されているか確認してください
- データベースの`user_achievements`テーブルを確認してください

### RLSエラー
- SupabaseダッシュボードでテーブルのRLSポリシーが正しく設定されているか確認してください
- ユーザーが認証されているか確認してください
