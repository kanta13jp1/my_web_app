# ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**ä½œæˆæ—¥**: 2025å¹´11æœˆ9æ—¥
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆä¸­
**å„ªå…ˆåº¦**: ä¸­

---

## ğŸ“‹ æ¦‚è¦

ãƒ¡ãƒ¢ã‚’æ›¸ããªãŒã‚‰è¨­å®šã§ãã‚‹ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€ç”Ÿç”£æ€§å‘ä¸Šã¨ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ã‚’å¼·åŒ–ã—ã¾ã™ã€‚

---

## ğŸ¯ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

### AS A ãƒ¦ãƒ¼ã‚¶ãƒ¼
### I WANT ãƒ¡ãƒ¢ã‚’æ›¸ããªãŒã‚‰ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šã§ãã‚‹
### SO THAT æ™‚é–“ã‚’æ„è­˜ã—ã¦åŠ¹ç‡çš„ã«ãƒ¡ãƒ¢ã‚’æ›¸ãã“ã¨ãŒã§ãã‚‹

---

## ğŸ“Š è¦ä»¶å®šç¾©

### æ©Ÿèƒ½è¦ä»¶

#### 1. ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ï¼ˆåŸºæœ¬ï¼‰
- **ã‚¿ã‚¤ãƒãƒ¼ã‚¿ã‚¤ãƒ—**:
  - ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼ï¼ˆ5åˆ†ã€10åˆ†ã€15åˆ†ã€25åˆ†ã€ã‚«ã‚¹ã‚¿ãƒ ï¼‰
  - ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒãƒ¼ï¼ˆã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒï¼‰
  - ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ï¼ˆ25åˆ† + 5åˆ†ä¼‘æ†©ï¼‰

- **ã‚¿ã‚¤ãƒãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**:
  - é–‹å§‹
  - ä¸€æ™‚åœæ­¢
  - ãƒªã‚»ãƒƒãƒˆ
  - åœæ­¢

- **ã‚¿ã‚¤ãƒãƒ¼é€šçŸ¥**:
  - ç”»é¢å†…é€šçŸ¥ï¼ˆçµ‚äº†æ™‚ï¼‰
  - ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 2. ãƒ¡ãƒ¢ã¨ã®é€£æº
- **ã‚¿ã‚¤ãƒãƒ¼ä»˜ããƒ¡ãƒ¢**:
  - ãƒ¡ãƒ¢ã«ã‚¿ã‚¤ãƒãƒ¼è¨˜éŒ²ã‚’ä¿å­˜
  - ã‚¿ã‚¤ãƒãƒ¼æ™‚é–“ã®å±¥æ­´ï¼ˆåˆè¨ˆæ™‚é–“ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ï¼‰
  - ã‚¿ã‚¤ãƒãƒ¼çµ±è¨ˆï¼ˆæ—¥æ¬¡ã€é€±æ¬¡ã€æœˆæ¬¡ï¼‰

- **ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**:
  - ã‚¿ã‚¤ãƒãƒ¼å®Œäº†ã§ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼ˆ25åˆ†å®Œäº† = 50ãƒã‚¤ãƒ³ãƒˆï¼‰
  - ã‚¿ã‚¤ãƒãƒ¼é–¢é€£ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆ
    - ã€Œåˆã‚ã¦ã®ã‚¿ã‚¤ãƒãƒ¼ã€- åˆå›ã‚¿ã‚¤ãƒãƒ¼å®Œäº†
    - ã€Œãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒã‚¹ã‚¿ãƒ¼ã€- 10å›ã®ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­å®Œäº†
    - ã€Œé›†ä¸­åŠ›ã®é¬¼ã€- ç´¯è¨ˆ10æ™‚é–“ã®ã‚¿ã‚¤ãƒãƒ¼å®Œäº†
    - ã€Œé€£ç¶šè¨˜éŒ²ã€- 7æ—¥é€£ç¶šã§ã‚¿ã‚¤ãƒãƒ¼ä½¿ç”¨

#### 3. è‡ªå‹•ä¿å­˜æ©Ÿèƒ½

**æ®µéšçš„å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:

##### ãƒ•ã‚§ãƒ¼ã‚º1: ä¿å­˜ãƒœã‚¿ãƒ³ã®æ”¹å–„ï¼ˆå³åº§ã«å®Ÿè£…ï¼‰
- **ç”»é¢é·ç§»ã—ãªã„ä¿å­˜ãƒœã‚¿ãƒ³**ã‚’è¿½åŠ 
  - ä¿å­˜å¾Œã‚‚ç”»é¢ã«ç•™ã¾ã‚‹
  - ã€Œä¿å­˜ã—ã¦é–‰ã˜ã‚‹ã€ã¨ã€Œä¿å­˜ã€ã®2ã¤ã®ãƒœã‚¿ãƒ³
  - ä¿å­˜å¾Œã«ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã§ã€Œä¿å­˜ã—ã¾ã—ãŸã€ã¨è¡¨ç¤º

##### ãƒ•ã‚§ãƒ¼ã‚º2: è‡ªå‹•ä¿å­˜ï¼ˆä¸­æœŸï¼‰
- **è‡ªå‹•ä¿å­˜ãƒˆãƒªã‚¬ãƒ¼**:
  - 3ç§’é–“å…¥åŠ›ãŒãªã„å ´åˆã«è‡ªå‹•ä¿å­˜
  - ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã‚‹å‰ã«è‡ªå‹•ä¿å­˜
  - å®šæœŸçš„ãªè‡ªå‹•ä¿å­˜ï¼ˆ30ç§’ã”ã¨ï¼‰

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º**:
  - ã€Œä¿å­˜ä¸­...ã€
  - ã€Œã™ã¹ã¦ã®å¤‰æ›´ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€
  - ã€Œã‚ªãƒ•ãƒ©ã‚¤ãƒ³ - å¤‰æ›´ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€

##### ãƒ•ã‚§ãƒ¼ã‚º3: UNDO/REDOæ©Ÿèƒ½ï¼ˆé•·æœŸï¼‰
- **UNDO/REDOå®Ÿè£…**:
  - Ctrl+Z / Ctrl+Yï¼ˆWindows/Linuxï¼‰
  - Cmd+Z / Cmd+Shift+Zï¼ˆmacOSï¼‰
  - æœ€å¤§50ã‚¹ãƒ†ãƒƒãƒ—ã®å±¥æ­´
  - å±¥æ­´ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¿å­˜

---

## ğŸ¨ UI/UXè¨­è¨ˆ

### ã‚¿ã‚¤ãƒãƒ¼UI

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒãƒ¼ï¼ˆæ¨å¥¨ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿                         â”‚
â”‚                                      â”‚
â”‚  [ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›æ¬„]                   â”‚
â”‚                                      â”‚
â”‚  [æœ¬æ–‡å…¥åŠ›æ¬„...]                     â”‚
â”‚  ...                                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  â±ï¸ 25:00       â”‚  â† ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚° â”‚
â”‚  â”‚  [â–¶] [â¸] [â¹]   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: ãƒ˜ãƒƒãƒ€ãƒ¼çµ±åˆå‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< æˆ»ã‚‹] ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿     [ä¿å­˜] [â‹®] â”‚
â”‚ â±ï¸ 25:00  [â–¶] [â¸] [â¹]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›æ¬„]                   â”‚
â”‚                                      â”‚
â”‚  [æœ¬æ–‡å…¥åŠ›æ¬„...]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: ãƒœãƒˆãƒ ãƒãƒ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿                         â”‚
â”‚                                      â”‚
â”‚  [ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›æ¬„]                   â”‚
â”‚  [æœ¬æ–‡å…¥åŠ›æ¬„...]                     â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â±ï¸ 25:00  [â–¶] [â¸] [â¹]  [ä¿å­˜]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿å­˜ãƒœã‚¿ãƒ³ã®UIå¤‰æ›´

#### ç¾åœ¨ã®å®Ÿè£…
```dart
AppBar(
  actions: [
    IconButton(
      icon: const Icon(Icons.save),
      onPressed: _saveNote, // ä¿å­˜å¾Œã«ç”»é¢ã‚’é–‰ã˜ã‚‹
    ),
  ],
)
```

#### æ–°ã—ã„å®Ÿè£…ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1ï¼‰
```dart
AppBar(
  actions: [
    IconButton(
      icon: const Icon(Icons.save_outlined),
      tooltip: 'ä¿å­˜',
      onPressed: _saveNoteWithoutClosing, // ä¿å­˜å¾Œã‚‚ç”»é¢ã«ç•™ã¾ã‚‹
    ),
    IconButton(
      icon: const Icon(Icons.check),
      tooltip: 'ä¿å­˜ã—ã¦é–‰ã˜ã‚‹',
      onPressed: _saveNote, // ä¿å­˜å¾Œã«ç”»é¢ã‚’é–‰ã˜ã‚‹
    ),
    // ... ãã®ä»–ã®ãƒœã‚¿ãƒ³
  ],
)
```

---

## ğŸ”§ æŠ€è¡“å®Ÿè£…

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### 1. Timer Sessionï¼ˆæ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

```sql
CREATE TABLE timer_sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  note_id UUID REFERENCES notes(id) ON DELETE CASCADE,
  timer_type VARCHAR(20) NOT NULL, -- 'countdown', 'countup', 'pomodoro'
  duration_seconds INTEGER, -- è¨­å®šæ™‚é–“ï¼ˆã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç”¨ï¼‰
  actual_seconds INTEGER, -- å®Ÿéš›ã®çµŒéæ™‚é–“
  completed BOOLEAN DEFAULT FALSE,
  started_at TIMESTAMPTZ NOT NULL,
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_timer_sessions_user_id ON timer_sessions(user_id);
CREATE INDEX idx_timer_sessions_note_id ON timer_sessions(note_id);
CREATE INDEX idx_timer_sessions_started_at ON timer_sessions(started_at);
```

#### 2. Note Auto-Save Historyï¼ˆãƒ•ã‚§ãƒ¼ã‚º3ç”¨ï¼‰

```sql
CREATE TABLE note_versions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  note_id UUID REFERENCES notes(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  version_number INTEGER NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_note_versions_note_id ON note_versions(note_id);
CREATE INDEX idx_note_versions_created_at ON note_versions(created_at);

-- å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®è‡ªå‹•å‰Šé™¤ï¼ˆ50ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä»¥ä¸Šä¿æŒã—ãªã„ï¼‰
-- Database Triggerã§å®Ÿè£…
```

### Flutterå®Ÿè£…

#### 1. TimerService

```dart
class TimerService {
  Timer? _timer;
  int _seconds = 0;
  TimerType _type = TimerType.countdown;
  TimerStatus _status = TimerStatus.idle;

  // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  Function(int)? onTick;
  Function()? onComplete;

  void start({required int duration, required TimerType type}) {
    _seconds = type == TimerType.countdown ? duration : 0;
    _type = type;
    _status = TimerStatus.running;

    _timer = Timer.periodic(const Duration(seconds: 1), (timer) {
      if (_type == TimerType.countdown) {
        _seconds--;
        if (_seconds <= 0) {
          complete();
        }
      } else {
        _seconds++;
      }
      onTick?.call(_seconds);
    });
  }

  void pause() {
    _timer?.cancel();
    _status = TimerStatus.paused;
  }

  void resume() {
    // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
    start(duration: _seconds, type: _type);
  }

  void stop() {
    _timer?.cancel();
    _status = TimerStatus.idle;
    _seconds = 0;
  }

  void complete() {
    _timer?.cancel();
    _status = TimerStatus.completed;
    onComplete?.call();
  }

  Future<void> saveSession({required String userId, String? noteId}) async {
    await supabase.from('timer_sessions').insert({
      'user_id': userId,
      'note_id': noteId,
      'timer_type': _type.name,
      'duration_seconds': _type == TimerType.countdown ? _seconds : null,
      'actual_seconds': _seconds,
      'completed': _status == TimerStatus.completed,
      'started_at': DateTime.now().toIso8601String(),
      'completed_at': _status == TimerStatus.completed
        ? DateTime.now().toIso8601String()
        : null,
    });
  }
}

enum TimerType { countdown, countup, pomodoro }
enum TimerStatus { idle, running, paused, completed }
```

#### 2. NoteEditorPageã®å¤‰æ›´

```dart
class _NoteEditorPageState extends State<NoteEditorPage> {
  // æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰...

  late final TimerService _timerService;
  bool _showTimer = false;

  @override
  void initState() {
    super.initState();
    // ... æ—¢å­˜ã®åˆæœŸåŒ–
    _timerService = TimerService();
    _timerService.onTick = (seconds) {
      setState(() {});
    };
    _timerService.onComplete = () {
      _onTimerComplete();
    };
  }

  @override
  void dispose() {
    _timerService.stop();
    super.dispose();
  }

  // ä¿å­˜ï¼ˆç”»é¢ã‚’é–‰ã˜ãªã„ï¼‰
  Future<void> _saveNoteWithoutClosing() async {
    try {
      final userId = supabase.auth.currentUser!.id;
      final isNewNote = widget.note == null;

      // ... ä¿å­˜å‡¦ç†ï¼ˆæ—¢å­˜ã®_saveNoteã¨ã»ã¼åŒã˜ï¼‰

      // Navigator.pop(context); ã‚’å‰Šé™¤

      // ä¿å­˜å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      if (!context.mounted) return;
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text('âœ… ä¿å­˜ã—ã¾ã—ãŸ'),
          duration: Duration(seconds: 2),
        ),
      );
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    }
  }

  // ã‚¿ã‚¤ãƒãƒ¼å®Œäº†æ™‚ã®å‡¦ç†
  Future<void> _onTimerComplete() async {
    final userId = supabase.auth.currentUser!.id;

    // ã‚¿ã‚¤ãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜
    await _timerService.saveSession(
      userId: userId,
      noteId: widget.note?.id,
    );

    // ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³: ãƒã‚¤ãƒ³ãƒˆç²å¾—
    await GamificationService().onTimerCompleted(userId);

    // é€šçŸ¥ã‚’è¡¨ç¤º
    if (!mounted) return;
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(
        content: Text('â±ï¸ ã‚¿ã‚¤ãƒãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸï¼+50ãƒã‚¤ãƒ³ãƒˆ'),
        duration: Duration(seconds: 3),
      ),
    );
  }

  // ã‚¿ã‚¤ãƒãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
  Widget _buildTimer() {
    if (!_showTimer) return const SizedBox.shrink();

    return Positioned(
      right: 16,
      bottom: 80,
      child: Material(
        elevation: 4,
        borderRadius: BorderRadius.circular(12),
        child: Container(
          padding: const EdgeInsets.all(12),
          child: Column(
            children: [
              Text(
                _formatTime(_timerService._seconds),
                style: const TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 8),
              Row(
                children: [
                  IconButton(
                    icon: Icon(
                      _timerService._status == TimerStatus.running
                        ? Icons.pause
                        : Icons.play_arrow,
                    ),
                    onPressed: () {
                      if (_timerService._status == TimerStatus.running) {
                        _timerService.pause();
                      } else {
                        _timerService.resume();
                      }
                      setState(() {});
                    },
                  ),
                  IconButton(
                    icon: const Icon(Icons.stop),
                    onPressed: () {
                      _timerService.stop();
                      setState(() {});
                    },
                  ),
                ],
              ),
            ],
          ),
        ),
      ),
    );
  }

  String _formatTime(int seconds) {
    final minutes = seconds ~/ 60;
    final secs = seconds % 60;
    return '${minutes.toString().padLeft(2, '0')}:${secs.toString().padLeft(2, '0')}';
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        // ...
        actions: [
          // ã‚¿ã‚¤ãƒãƒ¼ãƒœã‚¿ãƒ³
          IconButton(
            icon: const Icon(Icons.timer_outlined),
            tooltip: 'ã‚¿ã‚¤ãƒãƒ¼',
            onPressed: () {
              setState(() {
                _showTimer = !_showTimer;
              });
              if (_showTimer) {
                _showTimerSetupDialog();
              }
            },
          ),
          // ä¿å­˜ãƒœã‚¿ãƒ³ï¼ˆç”»é¢ã‚’é–‰ã˜ãªã„ï¼‰
          IconButton(
            icon: const Icon(Icons.save_outlined),
            tooltip: 'ä¿å­˜',
            onPressed: _saveNoteWithoutClosing,
          ),
          // ä¿å­˜ã—ã¦é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
          IconButton(
            icon: const Icon(Icons.check),
            tooltip: 'ä¿å­˜ã—ã¦é–‰ã˜ã‚‹',
            onPressed: _saveNote,
          ),
          // ... ãã®ä»–ã®ãƒœã‚¿ãƒ³
        ],
      ),
      body: Stack(
        children: [
          // ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿æœ¬ä½“
          // ...

          // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒãƒ¼
          _buildTimer(),
        ],
      ),
    );
  }

  void _showTimerSetupDialog() {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('â±ï¸ ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®š'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ListTile(
              title: const Text('5åˆ†'),
              onTap: () {
                _timerService.start(duration: 300, type: TimerType.countdown);
                Navigator.pop(context);
              },
            ),
            ListTile(
              title: const Text('10åˆ†'),
              onTap: () {
                _timerService.start(duration: 600, type: TimerType.countdown);
                Navigator.pop(context);
              },
            ),
            ListTile(
              title: const Text('25åˆ†ï¼ˆãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ï¼‰'),
              onTap: () {
                _timerService.start(duration: 1500, type: TimerType.pomodoro);
                Navigator.pop(context);
              },
            ),
            ListTile(
              title: const Text('ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—'),
              onTap: () {
                _timerService.start(duration: 0, type: TimerType.countup);
                Navigator.pop(context);
              },
            ),
          ],
        ),
      ),
    );
  }
}
```

---

## ğŸ“Š ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ

### ãƒã‚¤ãƒ³ãƒˆç²å¾—

```dart
// gamification_service.dart ã«è¿½åŠ 

Future<List<dynamic>> onTimerCompleted(String userId) async {
  try {
    // ãƒã‚¤ãƒ³ãƒˆä»˜ä¸
    await _awardPoints(userId, 50, 'timer_completed');

    // ã‚¿ã‚¤ãƒãƒ¼é–¢é€£ã®çµ±è¨ˆã‚’æ›´æ–°
    await _incrementTimerCount(userId);

    // ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆåˆ¤å®š
    final achievements = await _checkTimerAchievements(userId);

    return achievements;
  } catch (error) {
    print('Error in onTimerCompleted: $error');
    return [];
  }
}

Future<void> _incrementTimerCount(String userId) async {
  await supabase.rpc('increment_timer_count', params: {
    'p_user_id': userId,
  });
}

Future<List<dynamic>> _checkTimerAchievements(String userId) async {
  final achievements = <dynamic>[];

  // ã‚¿ã‚¤ãƒãƒ¼çµ±è¨ˆã‚’å–å¾—
  final stats = await supabase
    .from('timer_sessions')
    .select('id, completed')
    .eq('user_id', userId)
    .eq('completed', true);

  final completedCount = stats.length;
  final totalSeconds = stats.fold<int>(
    0,
    (sum, session) => sum + (session['actual_seconds'] as int? ?? 0),
  );

  // ã‚¢ãƒãƒ¼ãƒ–ãƒ¡ãƒ³ãƒˆåˆ¤å®š
  if (completedCount == 1) {
    achievements.add({'name': 'åˆã‚ã¦ã®ã‚¿ã‚¤ãƒãƒ¼', 'points': 100});
  }
  if (completedCount == 10) {
    achievements.add({'name': 'ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒã‚¹ã‚¿ãƒ¼', 'points': 500});
  }
  if (totalSeconds >= 36000) { // 10æ™‚é–“
    achievements.add({'name': 'é›†ä¸­åŠ›ã®é¬¼', 'points': 1000});
  }

  return achievements;
}
```

---

## ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### ãƒ•ã‚§ãƒ¼ã‚º1: ä¿å­˜ãƒœã‚¿ãƒ³æ”¹å–„ï¼ˆWeek 1ï¼‰
- [ ] ã€Œä¿å­˜ã€ã¨ã€Œä¿å­˜ã—ã¦é–‰ã˜ã‚‹ã€ã®2ã¤ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
- [ ] ä¿å­˜å¾Œã®ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤º
- [ ] ãƒ†ã‚¹ãƒˆ

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ï¼ˆWeek 2-3ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆtimer_sessionsï¼‰
- [ ] TimerServiceã®å®Ÿè£…
- [ ] NoteEditorPageã¸ã®ã‚¿ã‚¤ãƒãƒ¼UIè¿½åŠ 
- [ ] ã‚¿ã‚¤ãƒãƒ¼è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- [ ] ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆ
- [ ] ã‚¿ã‚¤ãƒãƒ¼çµ±è¨ˆãƒšãƒ¼ã‚¸

### ãƒ•ã‚§ãƒ¼ã‚º3: è‡ªå‹•ä¿å­˜ï¼ˆMonth 2ï¼‰
- [ ] è‡ªå‹•ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ

### ãƒ•ã‚§ãƒ¼ã‚º4: UNDO/REDOï¼ˆMonth 3ï¼‰
- [ ] note_versionsãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- [ ] UNDO/REDOãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
- [ ] å±¥æ­´UI

---

## ğŸ“‹ ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- [ ] TimerService.start()
- [ ] TimerService.pause()
- [ ] TimerService.resume()
- [ ] TimerService.complete()

### çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹â†’ä¸€æ™‚åœæ­¢â†’å†é–‹â†’å®Œäº†
- [ ] ã‚¿ã‚¤ãƒãƒ¼å®Œäº†æ™‚ã®ãƒã‚¤ãƒ³ãƒˆç²å¾—
- [ ] ã‚¿ã‚¤ãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¿å­˜

### E2Eãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿ã§ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®š
- [ ] ã‚¿ã‚¤ãƒãƒ¼å®Œäº†ã¾ã§å¾…æ©Ÿ
- [ ] é€šçŸ¥ã¨ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèª

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### KPI
- ã‚¿ã‚¤ãƒãƒ¼ä½¿ç”¨ç‡: 20%ä»¥ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨
- ã‚¿ã‚¤ãƒãƒ¼å®Œäº†ç‡: 80%ä»¥ä¸Š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ: ã‚¿ã‚¤ãƒãƒ¼ä½¿ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¹³å‡ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“ +30%
- ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³: ã‚¿ã‚¤ãƒãƒ¼ä½¿ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®7æ—¥é–“ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ +20%

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [æˆé•·æˆ¦ç•¥ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](../roadmaps/GROWTH_STRATEGY_ROADMAP.md)
- [ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½](../user-docs/GAMIFICATION_README.md)

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ9æ—¥
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å®Ÿè£…é–‹å§‹æ™‚
