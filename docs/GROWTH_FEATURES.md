# 成長施策機能

登録者数を増やすために実装した機能の概要

## 実装日
2025-11-06

## 実装した機能

### 1. リアルタイム統計ダッシュボード 📊

**目的**: サイトの活動状況を可視化し、コミュニティの活発さをアピール

**機能**:
- リアルタイムのオンラインユーザー数表示
- 登録ユーザーとゲスト訪問者の分離表示
- 今日の新規登録者数
- 今日のアクティブユーザー数
- 総登録者数、総メモ数、総共有数、解除実績数などの全体統計

**実装ファイル**:
- `/lib/pages/statistics_page.dart`
- `/lib/services/presence_service.dart`
- `/lib/models/site_statistics.dart`
- `/lib/models/user_presence.dart`

**データベーステーブル**:
- `site_statistics` - サイト全体の統計情報
- `user_presence` - 認証済みユーザーのオンライン状態
- `guest_presence` - ゲスト訪問者のオンライン状態

---

### 2. 紹介プログラム 🎁

**目的**: 既存ユーザーに友達を招待するインセンティブを提供

**機能**:
- ユーザーごとに一意の紹介コードを自動生成
- 紹介コードを使った新規登録
- 紹介成功時に紹介者に100ポイントのボーナス
- 紹介統計の表示（紹介人数、成功数、獲得ポイント）
- 紹介ランキング
- 紹介リンクの簡単共有（コピー＆シェア機能）

**実装ファイル**:
- `/lib/pages/referral_page.dart`
- `/lib/services/referral_service.dart`
- `/lib/models/referral_code.dart`

**データベーステーブル**:
- `referral_codes` - ユーザーの紹介コード
- `referrals` - 紹介関係の記録

**使い方**:
```
紹介リンク: https://my-web-app-b67f4.web.app/signup?ref=XXXXXXXX
```

---

### 3. ウェルカムボーナス 🎉

**目的**: 新規登録を促進し、初期エンゲージメントを高める

**機能**:
- 新規登録時に自動的に500ポイント付与
- 紹介コード入力による追加ボーナス
- 登録時にわかりやすいボーナス通知

**実装場所**:
- `/lib/pages/auth_page.dart` の `_handleAuth()` メソッド

---

### 4. デイリーログインボーナス 🌅

**目的**: 継続的なログインを促し、ユーザーエンゲージメントを維持

**機能**:
- 毎日初回ログイン時にボーナスポイント付与
- 連続ログイン日数によるボーナスの増加
  - 1-3日: 10ポイント
  - 4-7日: 20ポイント
  - 8-14日: 30ポイント
  - 15-30日: 50ポイント
  - 31日以上: 100ポイント
- 連続ログイン数の追跡と表示

**実装ファイル**:
- `/lib/services/daily_login_service.dart`
- HomePageとAuthPageで自動チェック

**データベーステーブル**:
- `daily_login_rewards` - デイリーログイン記録

---

### 5. デイリーチャレンジ 🎯

**目的**: 日々の目標を提供し、アクティビティを促進

**機能**:
- 毎日更新されるチャレンジ
- チャレンジ種類:
  - メモ作成チャレンジ
  - ポイント獲得チャレンジ
  - メモ共有チャレンジ
- 進捗状況の可視化
- 達成時の報酬ポイント
- 報酬の手動クレーム機能

**実装ファイル**:
- `/lib/pages/daily_challenges_page.dart`
- `/lib/services/daily_challenge_service.dart`
- `/lib/models/daily_challenge.dart`

**データベーステーブル**:
- `daily_challenges` - チャレンジ定義
- `user_challenge_progress` - ユーザーの進捗状況

---

### 6. 公開メモギャラリー 🖼️

**目的**: コンテンツの発見性を高め、ソーシャル要素を追加

**機能**:
- メモを公開して他のユーザーと共有
- 3つのタブ:
  - 最新: 新しく公開されたメモ
  - トレンド: 最近人気のメモ（過去7日間）
  - 人気: いいね数が多いメモ
- いいね機能
- 閲覧数カウント
- カテゴリによるフィルタリング
- 人気カテゴリの表示

**実装ファイル**:
- `/lib/pages/memo_gallery_page.dart`
- `/lib/services/public_memo_service.dart`
- `/lib/models/public_memo.dart`

**データベーステーブル**:
- `public_memos` - 公開メモ
- `memo_likes` - いいね記録

---

### 7. オンラインプレゼンストラッキング 👥

**目的**: リアルタイムでユーザーの活動を追跡し、コミュニティ感を醸成

**機能**:
- ユーザーのオンライン/オフライン状態の追跡
- 2分ごとのハートビート更新
- 5分間活動がない場合は自動的にオフライン
- ゲスト訪問者の追跡（30分で削除）
- セッションベースの追跡

**実装場所**:
- HomePageの `initState()` と `dispose()` で自動的に開始/停止
- `/lib/services/presence_service.dart`

---

### 8. オンボーディング追跡 📝

**目的**: 新規ユーザーの初期体験を管理

**データベーステーブル**:
- `user_onboarding` - オンボーディング状態の追跡
  - ウェルカムボーナス受領状態
  - チュートリアル完了状態
  - 初回メモ作成
  - 初回カテゴリ作成
  - プロフィール完成度

---

## データベースのセットアップ

### マイグレーションの実行

```bash
# Supabaseプロジェクトにマイグレーションを適用
supabase db push

# または、SQLファイルを直接実行
psql -h [HOST] -U postgres -d postgres -f supabase/migrations/20251106_growth_features.sql
```

### 統計の初期化

データベース関数を使用して統計を更新:

```sql
-- サイト統計を更新
SELECT update_site_statistics();

-- 古いプレゼンスレコードをクリーンアップ
SELECT cleanup_old_presence();
```

### 定期実行の設定（推奨）

pg_cronまたは外部cronジョブで以下を定期実行:

```sql
-- 1時間ごとに統計を更新
SELECT update_site_statistics();

-- 10分ごとにプレゼンスをクリーンアップ
SELECT cleanup_old_presence();
```

---

## ナビゲーション

新しい機能へのアクセス方法:

1. **サイト統計**: ホーム画面のメニュー → 「サイト統計」
2. **紹介プログラム**: ホーム画面のメニュー → 「紹介プログラム」
3. **デイリーチャレンジ**: ホーム画面のメニュー → 「デイリーチャレンジ」
4. **メモギャラリー**: ホーム画面のメニュー → 「メモギャラリー」

---

## セキュリティとプライバシー

- すべてのテーブルでRow Level Security (RLS) が有効
- ユーザーは自分のデータのみアクセス可能
- 公開メモとサイト統計は全ユーザーが閲覧可能
- プレゼンス情報は最小限のデータのみ保存

---

## 期待される効果

### 短期的効果（1-2週間）
- 新規登録者の初期ポイント獲得によるエンゲージメント向上
- デイリーログインボーナスによる日次アクティブユーザー増加
- 紹介プログラムによる口コミでの新規ユーザー獲得

### 中期的効果（1-3ヶ月）
- 公開メモギャラリーによるコンテンツ価値の向上
- デイリーチャレンジによる継続的なユーザー活動
- リアルタイム統計によるコミュニティ感の醸成

### 長期的効果（3ヶ月以上）
- 紹介ランキングによる競争とさらなる紹介の促進
- ユーザー生成コンテンツの蓄積
- ネットワーク効果による自然な成長

---

## 今後の拡張案

1. **ソーシャル機能の強化**
   - ユーザー間のフォロー機能
   - コメント機能
   - メモへの返信

2. **ゲーミフィケーションの深化**
   - ウィークリーチャレンジ
   - シーズンパス
   - 特別イベント

3. **コミュニティ機能**
   - グループ/チーム機能
   - 共同メモ作成
   - グループチャレンジ

4. **通知システム**
   - プッシュ通知（PWA）
   - メール通知
   - チャレンジリマインダー

5. **分析とレポート**
   - ユーザー成長ダッシュボード
   - エンゲージメント分析
   - リテンション率の追跡

---

## トラブルシューティング

### プレゼンストラッキングが動作しない
- データベース関数が正しく作成されているか確認
- RLSポリシーが正しく設定されているか確認
- ブラウザのコンソールでエラーを確認

### 紹介コードが生成されない
- トリガー `create_referral_code_on_signup` が有効か確認
- `auth.users` テーブルへのINSERTが成功しているか確認

### デイリーチャレンジの進捗が更新されない
- `GamificationService` から `DailyChallengeService` の連携を確認
- チャレンジの日付が今日のものか確認

---

## 関連ドキュメント

- [データベーススキーマ](/supabase/migrations/20251106_growth_features.sql)
- [既存の改善履歴](/docs/IMPROVEMENTS.md)
- [メインREADME](/README.md)
