# ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â±ï¸

**ä½œæˆæ—¥**: 2025å¹´11æœˆ10æ—¥
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ10æ—¥
**ç›®çš„**: ãƒ¡ãƒ¢ã‚’æ›¸ããªãŒã‚‰è¨­å®šã§ãã‚‹ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ã®è¨­è¨ˆã¨å®Ÿè£…

---

## ğŸ“‹ è¦ä»¶å®šç¾©

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¦æœ›
> ãƒ¡ãƒ¢ã‚’æ›¸ããªãŒã‚‰è¨­å®šã§ãã‚‹ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ãŒæ¬²ã—ã„
> æ“ä½œæ–¹æ³•ãŒä¸æ˜

### æ©Ÿèƒ½è¦ä»¶
1. **ãƒ¡ãƒ¢ç·¨é›†ä¸­ã«ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šã§ãã‚‹**
2. **ã‚¿ã‚¤ãƒãƒ¼ãŒè¦–è¦šçš„ã«ã‚ã‹ã‚Šã‚„ã™ã„**
3. **æ“ä½œãŒç°¡å˜**
4. **é€šçŸ¥æ©Ÿèƒ½**ï¼ˆæ™‚é–“ã«ãªã£ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒ ï¼‰
5. **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‹•ä½œ**ï¼ˆä»–ã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¦ã‚‚ç¶™ç¶šï¼‰
6. **è¤‡æ•°ã‚¿ã‚¤ãƒãƒ¼å¯¾å¿œ**ï¼ˆå°†æ¥çš„ã«ï¼‰

### éæ©Ÿèƒ½è¦ä»¶
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: ã‚¿ã‚¤ãƒãƒ¼å‹•ä½œãŒè»½é‡
- UI/UX: ç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ã„
- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£: è¦–è¦šãƒ»è´è¦šéšœå®³è€…ã«ã‚‚å¯¾å¿œ

---

## ğŸ¨ UI/UXè¨­è¨ˆ

### ãƒ‡ã‚¶ã‚¤ãƒ³ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
**"ã‚·ãƒ³ãƒ—ãƒ«ã§ç›´æ„Ÿçš„ã€é‚ªé­”ã«ãªã‚‰ãªã„"**

### é…ç½®æ¡ˆ

#### æ¡ˆ1: ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒãƒ¼ï¼ˆæ¨å¥¨ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¿ã‚¤ãƒˆãƒ«                            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                     â”‚
â”‚ ãƒ¡ãƒ¢æœ¬æ–‡...                         â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â† ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒãƒ¼
â”‚                         â”‚ â± 25:00 â”‚ â”‚   ï¼ˆå³ä¸‹ã«å›ºå®šï¼‰
â”‚                         â”‚ [ä¸€æ™‚åœæ­¢]â”‚ â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¡ˆ2: ãƒ˜ãƒƒãƒ€ãƒ¼çµ±åˆã‚¿ã‚¤ãƒãƒ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¿ã‚¤ãƒˆãƒ«          â± 25:00 [åœæ­¢]   â”‚ â† ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚¿ã‚¤ãƒãƒ¼
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                     â”‚
â”‚ ãƒ¡ãƒ¢æœ¬æ–‡...                         â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¡ˆ3: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¿ã‚¤ãƒãƒ¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¿ã‚¤ãƒãƒ¼   â”‚ ã‚¿ã‚¤ãƒˆãƒ«               â”‚
â”‚ â± 25:00    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ [åœæ­¢]     â”‚                        â”‚
â”‚            â”‚ ãƒ¡ãƒ¢æœ¬æ–‡...            â”‚
â”‚ ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ â”‚                        â”‚
â”‚ [ ] 25åˆ†   â”‚                        â”‚
â”‚ [ ] 5åˆ†ä¼‘æ†©â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨å¥¨**: **æ¡ˆ1ï¼ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¿ã‚¤ãƒãƒ¼ï¼‰**
- ç”»é¢ã‚’å æœ‰ã—ãªã„
- ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã§ä½ç½®èª¿æ•´å¯èƒ½
- æœ€å°åŒ–/æœ€å¤§åŒ–å¯èƒ½

---

### ã‚¿ã‚¤ãƒãƒ¼è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¿ã‚¤ãƒãƒ¼è¨­å®š                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ æ™‚é–“ã‚’è¨­å®š                      â”‚
â”‚ â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”            â”‚
â”‚ â”‚ 0 â”‚æ™‚â”‚ 25â”‚åˆ†â”‚ 00â”‚ç§’          â”‚
â”‚ â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜            â”‚
â”‚                                 â”‚
â”‚ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š                    â”‚
â”‚ [5åˆ†] [10åˆ†] [15åˆ†] [25åˆ†]      â”‚
â”‚ [30åˆ†] [45åˆ†] [1æ™‚é–“]           â”‚
â”‚                                 â”‚
â”‚ ã‚¿ã‚¤ãƒãƒ¼åï¼ˆä»»æ„ï¼‰              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­                â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚ çµ‚äº†æ™‚ã®å‹•ä½œ                    â”‚
â”‚ â˜‘ ã‚µã‚¦ãƒ³ãƒ‰ã§é€šçŸ¥              â”‚
â”‚ â˜‘ ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥                â”‚
â”‚ â–¡ è‡ªå‹•ä¿å­˜                    â”‚
â”‚                                 â”‚
â”‚         [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [é–‹å§‹]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ã‚¿ã‚¤ãƒãƒ¼å®Ÿè¡Œä¸­UI

#### æœ€å°åŒ–çŠ¶æ…‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â± 24:35     â”‚
â”‚ [â¸] [â¹]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æœ€å¤§åŒ–çŠ¶æ…‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­          â”‚
â”‚                     â”‚
â”‚       24:35         â”‚ â† å¤§ããè¡¨ç¤º
â”‚                     â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”          â”‚ â† ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
â”‚ 2% (æ®‹ã‚Š24åˆ†)       â”‚
â”‚                     â”‚
â”‚ [â¸ ä¸€æ™‚åœæ­¢]        â”‚
â”‚ [â¹ åœæ­¢]           â”‚
â”‚ [ğŸ”„ ãƒªã‚»ãƒƒãƒˆ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æŠ€è¡“è¨­è¨ˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### 1. Timer ãƒ¢ãƒ‡ãƒ«
```dart
class Timer {
  final int id;
  final int? noteId;          // é–¢é€£ã™ã‚‹ãƒ¡ãƒ¢IDï¼ˆnullã®å ´åˆã¯æ±ç”¨ã‚¿ã‚¤ãƒãƒ¼ï¼‰
  final String name;          // ã‚¿ã‚¤ãƒãƒ¼åï¼ˆä¾‹: "ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­"ï¼‰
  final int durationSeconds;  // è¨­å®šæ™‚é–“ï¼ˆç§’ï¼‰
  final DateTime startedAt;   // é–‹å§‹æ™‚åˆ»
  final TimerStatus status;   // å®Ÿè¡Œä¸­ã€ä¸€æ™‚åœæ­¢ã€å®Œäº†
  final bool soundNotification;   // ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥ON/OFF
  final bool browserNotification; // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥ON/OFF
  final bool autoSave;            // çµ‚äº†æ™‚ã«è‡ªå‹•ä¿å­˜

  Timer({
    required this.id,
    this.noteId,
    required this.name,
    required this.durationSeconds,
    required this.startedAt,
    required this.status,
    this.soundNotification = true,
    this.browserNotification = true,
    this.autoSave = false,
  });
}

enum TimerStatus {
  running,   // å®Ÿè¡Œä¸­
  paused,    // ä¸€æ™‚åœæ­¢
  completed, // å®Œäº†
  stopped,   // åœæ­¢
}
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒï¼ˆSupabaseï¼‰

```sql
-- ã‚¿ã‚¤ãƒãƒ¼å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥çš„ãªçµ±è¨ˆæ©Ÿèƒ½ç”¨ï¼‰
CREATE TABLE timers (
  id BIGSERIAL PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  note_id BIGINT REFERENCES notes(id) ON DELETE CASCADE,
  name TEXT NOT NULL DEFAULT 'ã‚¿ã‚¤ãƒãƒ¼',
  duration_seconds INTEGER NOT NULL,
  started_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  completed_at TIMESTAMPTZ,
  status TEXT NOT NULL DEFAULT 'running' CHECK (status IN ('running', 'paused', 'completed', 'stopped')),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_timers_user_id ON timers(user_id);
CREATE INDEX idx_timers_note_id ON timers(note_id);
CREATE INDEX idx_timers_status ON timers(status);

-- RLSãƒãƒªã‚·ãƒ¼
ALTER TABLE timers ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own timers"
  ON timers FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own timers"
  ON timers FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own timers"
  ON timers FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete their own timers"
  ON timers FOR DELETE
  USING (auth.uid() = user_id);
```

---

### ã‚µãƒ¼ãƒ“ã‚¹è¨­è¨ˆ

#### TimerService
```dart
// lib/services/timer_service.dart

import 'dart:async';
import 'package:flutter/foundation.dart';
import 'package:supabase_flutter/supabase_flutter.dart';

class TimerService extends ChangeNotifier {
  final SupabaseClient _supabase = Supabase.instance.client;

  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒãƒ¼
  AppTimer? _activeTimer;

  // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç”¨ã®StreamController
  StreamController<int>? _countdownController;

  // æ®‹ã‚Šæ™‚é–“ï¼ˆç§’ï¼‰
  int _remainingSeconds = 0;

  AppTimer? get activeTimer => _activeTimer;
  int get remainingSeconds => _remainingSeconds;
  bool get isRunning => _activeTimer?.status == TimerStatus.running;
  bool get isPaused => _activeTimer?.status == TimerStatus.paused;

  // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
  Future<void> startTimer({
    required String name,
    required int durationSeconds,
    int? noteId,
    bool soundNotification = true,
    bool browserNotification = true,
    bool autoSave = false,
  }) async {
    try {
      // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°åœæ­¢
      if (_activeTimer != null) {
        await stopTimer();
      }

      // Supabaseã«ä¿å­˜
      final response = await _supabase.from('timers').insert({
        'user_id': _supabase.auth.currentUser!.id,
        'note_id': noteId,
        'name': name,
        'duration_seconds': durationSeconds,
        'started_at': DateTime.now().toIso8601String(),
        'status': 'running',
      }).select().single();

      // ã‚¿ã‚¤ãƒãƒ¼ä½œæˆ
      _activeTimer = AppTimer.fromJson(response);
      _remainingSeconds = durationSeconds;

      // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
      _startCountdown();

      notifyListeners();
    } catch (e) {
      print('Error starting timer: $e');
      rethrow;
    }
  }

  // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
  void _startCountdown() {
    _countdownController?.close();
    _countdownController = StreamController<int>();

    Timer.periodic(const Duration(seconds: 1), (timer) {
      if (_activeTimer?.status != TimerStatus.running) {
        timer.cancel();
        return;
      }

      _remainingSeconds--;
      _countdownController?.add(_remainingSeconds);
      notifyListeners();

      // å®Œäº†
      if (_remainingSeconds <= 0) {
        timer.cancel();
        _onTimerComplete();
      }
    });
  }

  // ã‚¿ã‚¤ãƒãƒ¼å®Œäº†æ™‚ã®å‡¦ç†
  Future<void> _onTimerComplete() async {
    if (_activeTimer == null) return;

    try {
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
      await _supabase.from('timers').update({
        'status': 'completed',
        'completed_at': DateTime.now().toIso8601String(),
      }).eq('id', _activeTimer!.id);

      _activeTimer = _activeTimer!.copyWith(status: TimerStatus.completed);

      // é€šçŸ¥
      if (_activeTimer!.soundNotification) {
        _playSoundNotification();
      }
      if (_activeTimer!.browserNotification) {
        _showBrowserNotification();
      }

      // è‡ªå‹•ä¿å­˜
      if (_activeTimer!.autoSave && _activeTimer!.noteId != null) {
        // ãƒ¡ãƒ¢ã‚’è‡ªå‹•ä¿å­˜ï¼ˆNoteServiceã‚’ä½¿ç”¨ï¼‰
      }

      notifyListeners();
    } catch (e) {
      print('Error completing timer: $e');
    }
  }

  // ä¸€æ™‚åœæ­¢
  Future<void> pauseTimer() async {
    if (_activeTimer == null || _activeTimer!.status != TimerStatus.running) {
      return;
    }

    try {
      await _supabase.from('timers').update({
        'status': 'paused',
      }).eq('id', _activeTimer!.id);

      _activeTimer = _activeTimer!.copyWith(status: TimerStatus.paused);
      notifyListeners();
    } catch (e) {
      print('Error pausing timer: $e');
    }
  }

  // å†é–‹
  Future<void> resumeTimer() async {
    if (_activeTimer == null || _activeTimer!.status != TimerStatus.paused) {
      return;
    }

    try {
      await _supabase.from('timers').update({
        'status': 'running',
      }).eq('id', _activeTimer!.id);

      _activeTimer = _activeTimer!.copyWith(status: TimerStatus.running);
      _startCountdown();
      notifyListeners();
    } catch (e) {
      print('Error resuming timer: $e');
    }
  }

  // åœæ­¢
  Future<void> stopTimer() async {
    if (_activeTimer == null) return;

    try {
      await _supabase.from('timers').update({
        'status': 'stopped',
      }).eq('id', _activeTimer!.id);

      _countdownController?.close();
      _activeTimer = null;
      _remainingSeconds = 0;
      notifyListeners();
    } catch (e) {
      print('Error stopping timer: $e');
    }
  }

  // ãƒªã‚»ãƒƒãƒˆï¼ˆå†ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰
  Future<void> resetTimer() async {
    if (_activeTimer == null) return;

    final name = _activeTimer!.name;
    final durationSeconds = _activeTimer!.durationSeconds;
    final noteId = _activeTimer!.noteId;

    await stopTimer();
    await startTimer(
      name: name,
      durationSeconds: durationSeconds,
      noteId: noteId,
    );
  }

  // ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥
  void _playSoundNotification() {
    // HTML AudioElement ã‚’ä½¿ç”¨
    // assets/sounds/timer_complete.mp3 ã‚’å†ç”Ÿ
  }

  // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥
  Future<void> _showBrowserNotification() async {
    // Web Notification API ã‚’ä½¿ç”¨
    // ã€Œã‚¿ã‚¤ãƒãƒ¼ãŒçµ‚äº†ã—ã¾ã—ãŸã€ã‚’è¡¨ç¤º
  }

  @override
  void dispose() {
    _countdownController?.close();
    super.dispose();
  }
}
```

---

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­è¨ˆ

#### FloatingTimerWidget
```dart
// lib/widgets/floating_timer_widget.dart

class FloatingTimerWidget extends StatefulWidget {
  const FloatingTimerWidget({Key? key}) : super(key: key);

  @override
  State<FloatingTimerWidget> createState() => _FloatingTimerWidgetState();
}

class _FloatingTimerWidgetState extends State<FloatingTimerWidget> {
  bool _isExpanded = false;
  Offset _position = const Offset(20, 100);

  @override
  Widget build(BuildContext context) {
    final timerService = Provider.of<TimerService>(context);

    if (timerService.activeTimer == null) {
      return const SizedBox.shrink();
    }

    return Positioned(
      left: _position.dx,
      top: _position.dy,
      child: GestureDetector(
        onPanUpdate: (details) {
          setState(() {
            _position += details.delta;
          });
        },
        child: Material(
          elevation: 8,
          borderRadius: BorderRadius.circular(16),
          child: Container(
            padding: const EdgeInsets.all(16),
            decoration: BoxDecoration(
              color: Colors.white,
              borderRadius: BorderRadius.circular(16),
              boxShadow: [
                BoxShadow(
                  color: Colors.black.withOpacity(0.1),
                  blurRadius: 8,
                  offset: const Offset(0, 4),
                ),
              ],
            ),
            child: _isExpanded ? _buildExpandedTimer(timerService) : _buildMinimizedTimer(timerService),
          ),
        ),
      ),
    );
  }

  Widget _buildMinimizedTimer(TimerService timerService) {
    final minutes = timerService.remainingSeconds ~/ 60;
    final seconds = timerService.remainingSeconds % 60;

    return Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        const Icon(Icons.timer, size: 20),
        const SizedBox(width: 8),
        Text(
          '$minutes:${seconds.toString().padLeft(2, '0')}',
          style: const TextStyle(
            fontSize: 16,
            fontWeight: FontWeight.bold,
          ),
        ),
        IconButton(
          icon: Icon(timerService.isRunning ? Icons.pause : Icons.play_arrow),
          onPressed: () {
            if (timerService.isRunning) {
              timerService.pauseTimer();
            } else {
              timerService.resumeTimer();
            }
          },
        ),
        IconButton(
          icon: const Icon(Icons.expand_more),
          onPressed: () {
            setState(() {
              _isExpanded = true;
            });
          },
        ),
      ],
    );
  }

  Widget _buildExpandedTimer(TimerService timerService) {
    // å±•é–‹ç‰ˆã®UI
    // ...
  }
}
```

---

## ğŸ¯ å®Ÿè£…è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºæœ¬æ©Ÿèƒ½ï¼ˆ1é€±é–“ï¼‰
- [ ] TimerServiceã‚¯ãƒ©ã‚¹ä½œæˆ
- [ ] Timerãƒ¢ãƒ‡ãƒ«ä½œæˆ
- [ ] Supabaseãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
- [ ] FloatingTimerWidgetä½œæˆï¼ˆæœ€å°åŒ–çŠ¶æ…‹ã®ã¿ï¼‰
- [ ] ã‚¿ã‚¤ãƒãƒ¼è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä½œæˆ
- [ ] åŸºæœ¬çš„ãªã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ©Ÿèƒ½

### ãƒ•ã‚§ãƒ¼ã‚º2: UI/UXæ”¹å–„ï¼ˆ3-5æ—¥ï¼‰
- [ ] å±•é–‹çŠ¶æ…‹ã®UIå®Ÿè£…
- [ ] ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½
- [ ] ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¡¨ç¤º
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 

### ãƒ•ã‚§ãƒ¼ã‚º3: é€šçŸ¥æ©Ÿèƒ½ï¼ˆ2-3æ—¥ï¼‰
- [ ] ã‚µã‚¦ãƒ³ãƒ‰é€šçŸ¥å®Ÿè£…
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥å®Ÿè£…
- [ ] é€šçŸ¥è¨­å®šUI

### ãƒ•ã‚§ãƒ¼ã‚º4: çµ±è¨ˆãƒ»å±¥æ­´ï¼ˆå°†æ¥çš„ã«ï¼‰
- [ ] ã‚¿ã‚¤ãƒãƒ¼å±¥æ­´è¡¨ç¤º
- [ ] çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­çµ±è¨ˆ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- TimerServiceã®ãƒ¡ã‚½ãƒƒãƒ‰ãƒ†ã‚¹ãƒˆ
- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
- é€šçŸ¥æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ

### ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- FloatingTimerWidgetã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
- ãƒœã‚¿ãƒ³ã®ã‚¿ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ

### E2Eãƒ†ã‚¹ãƒˆ
- ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹â†’å®Œäº†ã®ãƒ•ãƒ­ãƒ¼
- ä¸€æ™‚åœæ­¢â†’å†é–‹ã®ãƒ•ãƒ­ãƒ¼
- é€šçŸ¥ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã‹

---

## ğŸ“š å‚è€ƒè³‡æ–™

### å‚è€ƒã‚¢ãƒ—ãƒª
- **Forest**: ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼
- **Focus To-Do**: ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼
- **Toggl Track**: æ™‚é–“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°

### æŠ€è¡“å‚è€ƒ
- [Web Notification API](https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API)
- [HTML Audio Element](https://developer.mozilla.org/en-US/docs/Web/API/HTMLAudioElement)

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ10æ—¥
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å®Ÿè£…å®Œäº†å¾Œ
**ä½œæˆè€…**: Claude Code
